<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="MyStyle.css"> <!-- The style sheet IS referenced (for the non-Highcharts at least). -->
        <title>Event Listener</title> <!-- appears in the tab of the browser (tested with Chrome) -->
    </head>
    <body>
        <!-- HTML HTML HTML -->
        <!-- HTML HTML HTML -->
        <!-- HTML HTML HTML -->
        <!-- It seems to me to be good practice to keep all the HTML elements together and away from the fancy JavaScript. -->
        <!-- So I've got them up here first. -->
        <!-- MAKE NO ATTEMPT TO STYLE THINGS beyond simple new lines (breaks) headings and pragraphs. -->
        <h1>Tests involving listening to events.</h1> <!-- Appears bang on top left (unless I change the css in future).  Don't try to centre here - do that in CSS. -->
        <p>Were you looking for the <a href="MyPage.html" title="go to the Main Page">main page</a>?</p>
        <h2>Updating Paragraphs</h2>
        <p>This is a paragraph part of which will update when the mouse hits the box below.<br><span id = "DynamicStatusParagraph">This text will change.</span></p>
        <div id = "AreaOfInterest">
            <h3>Heading 3 text that has been placed in a div.</h3>
            <p> Where it has been followed by a paragraph.<br><br>
                <!-- The metric names incorporate the actual trigger name. -->
                <!-- There is a listener below for every line here. -->
                Mouse Click Down <span id = metric_mousedown>(waiting)</span> <br> <!-- Counts left, right and aux presses. -->
                Mouse Click Release <span id = metric_mouseup>(waiting)</span> <br> <!-- Counts left, right and aux releases. -->
                Mouse Click <span id = metric_click>(waiting)</span> <br> <!-- Does NOT record double clicks.  -->
                Mouse Double Click <span id = metric_dblclick>(waiting)</span> <br> <!-- Double right/aux clicks are not a thing. Only counts left clicks. -->
                Mouse Right Click <span id = metric_contextmenu>(waiting)</span> <br> <!-- A right click is registered on release only. -->
                <!-- Note that with the pen: it records a right click if the aux button is pressed before a quick stab. -->
                Auxiliary Click <span id = metric_auxclick>(waiting)</span> <br>
                <!-- Note that a right click is classed as an auxiliary click too. -->
                <!-- Clicking the wheel on a mouse is an AUX click.-->
                Wheel Movement <span id = metric_wheel>(waiting)</span> <br>
                <!-- The mouse wheel move is quantised into something that matches the feel of using the wheel. -->
                Mouse Enter Zone <span id = metric_mouseenter>(waiting)</span> <br>
                Mouse Leave Zone <span id = metric_mouseleave>(waiting)</span> <br>
                Mouse Over Element <span id = metric_mouseover>(waiting)</span> <br>
                Mouse Out of Element <span id = metric_mouseout>(waiting)</span> <br>
                Mouse Move in Zone <span id = metric_mousemove>(waiting)</span> <br>
            </p>
        </div>
        <p>
            Mouse Over will trigger on every element it finds within the element that it's
            watching, so that includes the children.  Whereas Mouse Enter and Leave only deal
            with the parent element.  Note that the pen will trigger most things.  Curiously
            the pen works for Over, Enter, Leave and Move but has a strange reaction with down
            and up.  It seems a quick press of the screen and release is classed as a down followed
            quickly by an up.  But if the pen is pressed on the screen and held then no down or up
            is registered!  Pressing the aux button before a stab will register a right click.
        </p>
        <br>
        <h2>Clicking a button that makes changes (even to the button itself!).</h2>
        <p id = "DynamicClickParagraph">This paragraph will be changed by clicking.</p>
        <br>
        <button class = "notfancyButton" id = "ActivatingButton" onclick="getElementById('DynamicClickParagraph').innerHTML='I have been changed by a button click.'">Click to do something.</button>
        <!-- The thing after onclick is implied Javascrip (it seems). -->
        <p>This is an unstyled button.</p>
        <br><br>
        <button class = "fancyButton" id = "OtherActivatingButton" onclick="myButtonFunctionOne()">Make it say 'poop'.</button>
        <!-- On this second button the onclick makes direct reference to a JavaScript function. -->
        <p>This is a styled button.  Can you tell?</p>
    
        <!-- HTML end end -->
        <!-- HTML end end -->
        <!-- HTML end end -->

        <!-- Local override to the loaded CSS. -->
        <style>
            div {
                width: 250px;
                height: 100%;
                border: 1px solid black;
                margin: 10px;
                padding: 30px;
                float: left;
                text-align: center;
                background-color: lightgoldenrodyellow;
            }
            h3 {
                background-color: white;
            }
            #DynamicStatusParagraph {
                font-size: 10mm;
            }
        </style>


        <!-- First we have some utility script(s) -->

        <!-- Specific Functions for the second button.  I get this button to toggle what text is shows and what function it calls. -->
        <script>
                //??
                function myButtonFunctionOne() { // No parameters allowed without getting fancy (See other examples in this file).
                    document.getElementById("DynamicClickParagraph").innerHTML = "Poop"; // A direct change.  No need to assign to a variable.
                    document.getElementById("OtherActivatingButton").setAttribute( "onClick", "javascript: myButtonFunctionTwo();" );
                    document.getElementById("OtherActivatingButton").innerHTML = "Make it say 'AAArg!'";
                    // Note that it seems some elements use 'innerHTML' and some use 'value'.  'value' is for "input elemens and form things"?? (inner for the usual paragraphs etc)
                }
                function myButtonFunctionTwo() { // No parameters allowed without getting fancy (See other examples in this file).
                    document.getElementById("DynamicClickParagraph").innerHTML = "AAArg!"; // A direct change.  No need to assign to a variable.
                    document.getElementById("OtherActivatingButton").setAttribute( "onClick", "javascript: myButtonFunctionOne();" );
                    document.getElementById("OtherActivatingButton").innerHTML = "Make it say 'poop'.";
                }
            </script>
        

        <!-- Create the ability to pass parameters to event listeners. -->
        <script>
            // Very fancy thing from the web. https://stackoverflow.com/questions/256754/how-to-pass-arguments-to-addeventlistener-listener-function/54731362#54731362
            function addListenerWithArguments(htmlElement, eventBeingListenedTo, functionToBeCalled, passedArgument){
                // Declare fancyFunction as a function that already has a parameter baked into it (yes, clever, keep reading!)
                var fancyFunction = function(functionObject, eventBeingListenedTo, parameterForFunction){ // outer anonymous function
                        return (
                            function (){functionObject(eventBeingListenedTo, parameterForFunction);} // This is an anonymous function declaration too.
                        );
                }(functionToBeCalled, eventBeingListenedTo, passedArgument);
                // I believe these last lines (the parentheses) make the outer anonymous function be called immediately; which then means
                // that fancyFunction actually becomes the returned (inner anonymous) function from the calling of the outer one!!

                // So in the next line, which expects a function, the function it gets will be the inner function that, itslef, is
                // a function that has aleady got the parameter baked in.
                htmlElement.addEventListener(eventBeingListenedTo, fancyFunction);
            
                return fancyFunction; // So that it will be possible in future to remove the event listener if required.
            }
        </script>


        <!-- Generic function that reacts to the listener(s). -->
        <script>
            // Function to change the content of certain other elements.
            // NOTE - I've used fresh <script> tags for the place were I add the listener.
            // Because of that it means the listener must come AFTER the <script> where the funciton in defined other wise it is undefined.
            // However if I had put the listener in the same <script> block then the compiler sorts out the order and the reference.

            var myCounters = new Map; // Use the reason for the trigger as the index in a map of counters.
            function myReaction(triggerReason, triggerWords) {
                // Put some words down to show what has happened.  Unless it's the Mouse Move which is too dominant.  (It'll still get counted - see elsewhere).
                triggerReason == "mousemove"? /*nothing*/null:document.getElementById("DynamicStatusParagraph").innerHTML = triggerWords;

                myCounters.has(triggerReason) ? myCounters.set(triggerReason,myCounters.get(triggerReason) + 1): myCounters.set(triggerReason,1);
                document.getElementById("metric_"+triggerReason).innerHTML = myCounters.get(triggerReason);

            }
        </script>
    

        <!-- Selecting what to listen out for. -->
        <script>
            var myElementOfInterest = "AreaOfInterest"
            storedForLaterListenerRemoval = addListenerWithArguments(document.getElementById(myElementOfInterest),"mouseover",myReaction,"There has been a mouse over.");
            // To remove the listener, use the normal routine:
            // theElememtTheListenerWasAttachedTo.removeEventListener("particular listend to action", storedForLaterListenerRemoval);
            // Partner piece for the code above.  Same link: https://stackoverflow.com/questions/256754/how-to-pass-arguments-to-addeventlistener-listener-function/54731362#54731362

            // The following ignore the facility to remove them later (ie don't bother with the return value like the one above).
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mousedown",myReaction,"There has been a press of the mouse button on the element.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mouseup",myReaction,"There has been a lift of the mouse button on the element.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mouseenter",myReaction,"The mouse has entered the zone.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mouseleave",myReaction,"The mouse has left the zone.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mousemove",myReaction,"The mouse has moved off an element.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"mouseout",myReaction,"The mouse has moved in the zone.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"contextmenu",myReaction,"The right mouse button has been pressed.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"dblclick",myReaction,"There has been a double-click.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"click",myReaction,"There has been a click.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"auxclick",myReaction,"There has been an auxilliary click.");
            addListenerWithArguments(document.getElementById(myElementOfInterest),"wheel",myReaction,"There has been a wheel move (direction unknown).");
            // The following are ones I could not get to work with this DIV element.
            //addListenerWithArguments(document.getElementById(myElementOfInterest),"focus",myReaction,"The element has received focus.");
            //addListenerWithArguments(document.getElementById(myElementOfInterest),"blur",myReaction,"The element has lost focus.");
            //addListenerWithArguments(document.getElementById(myElementOfInterest),"resize",myReaction,"The page was resized.");
            //addListenerWithArguments(document.getElementById(myElementOfInterest),"scroll",myReaction,"The page scrolled.");
            // See: https://developer.mozilla.org/en-US/docs/Web/Events
        </script>

    </body>
</html>