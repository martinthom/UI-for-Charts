<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="MyStyle.css"> <!-- The style sheet IS referenced (for the non-Highcharts at least). -->
        <title>MyPage Browser Tab Test</title> <!-- appears in the tab of the browser (tested with Chrome) -->
		
		<!-- Now bring in the HighCharts library (javascript) -->
		<script src="./Highcharts/Highcharts-7.2.1/code/highcharts.js"></script>
        <!-- This line that references the web does work.  I just wanted to have everything local.
		<script src="https://code.highcharts.com/highcharts.js"></script>
		-->
		
    </head>
    <body>
        <h1>MyPage Body Title</h1> <!-- Appears bang on top left (unless I change the css in future) -->
        <p>This is a really interesting paragraph.</p> <!-- A piece of HTML for old-times sake. -->
		
		<!-- Interestingly the Chrome browser comments out the next lines of php! -->
		<!-- This is because php is a server-side scripting language and a browser just doesn't know what to do with it! -->
		<?php
		echo file_get_contents("MyTextFile.txt");
		?>

		<?php
		echo "Hello World!";
		?>
		
		<!-- OK so I want to see if I can get a file from the web server into this paragraph. -->
		<!-- NB AJAX stands for Asynchronous JavaScript And XML -->
		<p id="nominatedparagraph">This is where the CSV will go.</p>

		<button type="button" onclick="loadDocFunction()">Change Content</button> <!-- HTML: Call the function below every time the button is clicked. -->

		<script> // Back to Javascript
			function loadDocFunction() {
				var xhttp = new XMLHttpRequest(); // Get an AJAX object.
				// Get ANOTHER function (in-line one) and add it to the listener that is waiting for something to come back from the request that we make later down the page.
				xhttp.onreadystatechange = function() { 
					if (this.readyState == 4 && this.status == 200) {
						// Do only if it *is* ready [4] and the response was completed correctly [200]
						// And if so we then change the inner HTML of the nominated element.
						document.getElementById("nominatedparagraph").innerHTML = this.responseText;
					}
					else {
						// Otherwise still change the nominated element but to the error codes.
						document.getElementById("nominatedparagraph").innerHTML = "" + this.readyState + " " + this.status;
						// I get a zero (0) because of CORS (Cross Origin Resource Sharing)
						// This is a security feature.  I am loading this HTML locally on my laptop so my laptop is the domain that
						// served the page.  But I'm asking for a resource that is from a different domain (the Pi) so it is not allowed.
					}
				};
				// The above function gets called AFTER something happens.  To make something happen we have to create a message:
				xhttp.open("GET", "http://192.168.1.132:8008/sample.csv", true);
				// Note that saying "true" makes it asynchronous so that this is a non-blocking call.
				// Which is why we have to listen for a ready state change to get the reply when it comes.
				
				// And then send it.
				xhttp.send();
				// NB a "GET" is like a web URL.  IIRC a "POST" will put data in the body of the outgoing message too.
			}
		</script>



		<!-- Now locate the place where the chart will go.  ie make a div. -->
        <div id="MyContainer" style="width:100%; height:400px;"></div>
		
		<!-- Work in progress as I try to figure out how to separate the data from the display. -->
		<!-- Ideally I want to have the data as a downloaded local file (I think). -->
		<script>
			var MyRowNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday']; // Imagine this as a long list of date times.
			var MyColumnSeries = [{type: 'column', name: 'Jane', data: [4,3,5,4]}, // Imagine values for this column corresponding to date times.
								  {type: 'column', name: 'John', data: [7,2,8,6]},
								  {type: 'line', name: 'Jack', data: [11,1,7,8]}  ];
		</script>
		
		<!-- Making sure the options array variable is distinct from the code that makes it all happen. -->
		<!-- For future reference see https://www.highcharts.com/docs/chart-and-series-types/combining-chart-types -->
		<!-- and in Fiddle: https://jsfiddle.net/gh/get/library/pure/highcharts/highcharts/tree/master/samples/highcharts/demo/combo/ -->
        <script>
		var chartOptions ={
				// If the whole chart is of one type then put it here:
				// chart: {type: 'bar'},
				// chart: {type: 'column'},
				// chart: {type: 'line'}, // This is the default if none given.
				// chart: {type: 'spline'},
				
				// Other options for the whole chart
				title: {text: 'Fruit Consumption'},
				xAxis: {title: {text: 'Fruit'}, categories: MyRowNames},
				yAxis: {title: {text: 'Fruit eaten'}},
				
				series: MyColumnSeries
				// The per-series data
				/* eg
				series: [{
					type: 'column',
					name: 'Jane,
					data: [4,5,6]
				}, {
					type: 'column',
					name: 'John',
					data: [1,2,3]
				}]
				*/
			}
		</script>

		<!-- Now interact with HighCharts to get it to take over control of the div with the above data and above options. -->
        <script>		
		document.addEventListener('DOMContentLoaded', function () {
			var myChart = Highcharts.chart('MyContainer', chartOptions);
		});
		</script>
		
		<!-- And we're done.  But the chart remains interactive; probably due to the "listener" bit. -->
        
    </body>
</html>